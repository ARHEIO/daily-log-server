const expressJwt = require('express-jwt');
const jwksRsa = require('jwks-rsa');

// Puts the user details into req.user
const checkJwt = expressJwt({
  secret: jwksRsa.expressJwtSecret({
    cache: true,
    rateLimit: true,
    jwksRequestsPerMinute: 5,
    jwksUri: `https://dev-iwdal1jj.au.auth0.com/.well-known/jwks.json`
  }),

  // Validate the audience and the issuer.
  issuer: `https://dev-iwdal1jj.au.auth0.com/`,
  algorithms: ['RS256']
});

module.exports = checkJwt;

/*
Google JWT
eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IlJVWkNOREF5TURBMFEwWkJRelZFTXpjNFJEVXhOMFV6T1Rrd1JFRTJOemRCTlVVMVFrTkZNUSJ9.eyJnaXZlbl9uYW1lIjoiQWRhbSIsImZhbWlseV9uYW1lIjoiRWdnbGVzdG9uIiwibmlja25hbWUiOiJhZGFtLnJoLmVnZ2xlc3RvbiIsIm5hbWUiOiJBZGFtIEVnZ2xlc3RvbiIsInBpY3R1cmUiOiJodHRwczovL2xoNS5nb29nbGV1c2VyY29udGVudC5jb20vLVcwdmxNYlRDZ0pjL0FBQUFBQUFBQUFJL0FBQUFBQUFBQUFBL0FDSGkzcmZ4YW5hQmk3Z1RWaDQ4ZkczWWlNWlBELVBoemcvcGhvdG8uanBnIiwibG9jYWxlIjoiZW4iLCJ1cGRhdGVkX2F0IjoiMjAxOS0wOS0xMVQwNDoyNzoyMS42OTFaIiwiZW1haWwiOiJhZGFtLnJoLmVnZ2xlc3RvbkBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiaXNzIjoiaHR0cHM6Ly9kZXYtaXdkYWwxamouYXUuYXV0aDAuY29tLyIsInN1YiI6Imdvb2dsZS1vYXV0aDJ8MTEwNzM3MjA4Mzk1MDIxMDA2OTg3IiwiYXVkIjoidVdHR2NwOGZLNGhSN3RHSkFrODVPeGRmOURwVUs1ckQiLCJpYXQiOjE1NjgxNzYwNDYsImV4cCI6MTU2ODIxMjA0Niwibm9uY2UiOiJDbGYxUEFiVG12MlBCYl9mNjZ0SnlfTUtDcXU3OE84NURSOV9GMExpWVJNIn0.WA1SIcy7vod-xoaE9yoy76zVvTuRwi_7B49GgAt3xqi3891ravC2SZfeO_TIXzAkxh83cQ-VRF21LIzBzJvLe5CV8MtauBNQf0NskOGpJFIo9_Fb66fMdCWGvlGD5hY2GsfgievFh7QHpbsbNCkyQ0a-Ad9k_Od1YEsFM6a1liDv7IvsS5JJZKv_pfX2_sRuVI8jx8Yuv_WtZ1ZHKC-B29O_5_kXZWla0RQb_uuzg9zBiBbHO0NRjinwny65kxilPOapMPR0b_QvBrDXtCUYDdonEwwAUhsQSEVls4yaLZIvqiKZqUjGBvpRbmwcb3LXGczZUQHecsrQ3rxLDRCqGA
https://jwt.io/#debugger-io?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IlJVWkNOREF5TURBMFEwWkJRelZFTXpjNFJEVXhOMFV6T1Rrd1JFRTJOemRCTlVVMVFrTkZNUSJ9.eyJnaXZlbl9uYW1lIjoiQWRhbSIsImZhbWlseV9uYW1lIjoiRWdnbGVzdG9uIiwibmlja25hbWUiOiJhZGFtLnJoLmVnZ2xlc3RvbiIsIm5hbWUiOiJBZGFtIEVnZ2xlc3RvbiIsInBpY3R1cmUiOiJodHRwczovL2xoNS5nb29nbGV1c2VyY29udGVudC5jb20vLVcwdmxNYlRDZ0pjL0FBQUFBQUFBQUFJL0FBQUFBQUFBQUFBL0FDSGkzcmZ4YW5hQmk3Z1RWaDQ4ZkczWWlNWlBELVBoemcvcGhvdG8uanBnIiwibG9jYWxlIjoiZW4iLCJ1cGRhdGVkX2F0IjoiMjAxOS0wOS0xMVQwNDoyNzoyMS42OTFaIiwiZW1haWwiOiJhZGFtLnJoLmVnZ2xlc3RvbkBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiaXNzIjoiaHR0cHM6Ly9kZXYtaXdkYWwxamouYXUuYXV0aDAuY29tLyIsInN1YiI6Imdvb2dsZS1vYXV0aDJ8MTEwNzM3MjA4Mzk1MDIxMDA2OTg3IiwiYXVkIjoidVdHR2NwOGZLNGhSN3RHSkFrODVPeGRmOURwVUs1ckQiLCJpYXQiOjE1NjgxNzYwNDYsImV4cCI6MTU2ODIxMjA0Niwibm9uY2UiOiJDbGYxUEFiVG12MlBCYl9mNjZ0SnlfTUtDcXU3OE84NURSOV9GMExpWVJNIn0.WA1SIcy7vod-xoaE9yoy76zVvTuRwi_7B49GgAt3xqi3891ravC2SZfeO_TIXzAkxh83cQ-VRF21LIzBzJvLe5CV8MtauBNQf0NskOGpJFIo9_Fb66fMdCWGvlGD5hY2GsfgievFh7QHpbsbNCkyQ0a-Ad9k_Od1YEsFM6a1liDv7IvsS5JJZKv_pfX2_sRuVI8jx8Yuv_WtZ1ZHKC-B29O_5_kXZWla0RQb_uuzg9zBiBbHO0NRjinwny65kxilPOapMPR0b_QvBrDXtCUYDdonEwwAUhsQSEVls4yaLZIvqiKZqUjGBvpRbmwcb3LXGczZUQHecsrQ3rxLDRCqGA&publicKey=-----BEGIN%20PUBLIC%20KEY-----%0AMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3cciXnGpyUIUzyGTb3zI%0Aefxc4B2uXa2hlNPCViQTiTSUJIrZZFz3aw6aAkur2mw3ffvGhshYdnHCjusBJLxV%0A6HE6t3I93IICVSyt9IUNR7gkbAiQYbJHXIy5Jbua52oa%2Be1QXTHk7Xl8tw4NpcTE%0AaepPAraIlg7a01qAWgi0NAFj26eD6qtJ0Lr3422tgt7qjFEWjE4nCgOKDZ%2BTUo5t%0A4FzfVwcTSGayx%2FH0DwakEvxQjMpkcVzlAYGjswsN2HFhqRvT7k3nUFK%2Bp52S%2F0rd%0AdBw7Eksu%2FYCZBBY9BZR4FHahWHZ1eN2o59CF7sMkDclL%2BehKni42MOfeShVUzGam%0AyQIDAQAB%0A-----END%20PUBLIC%20KEY-----%0A
{
  "given_name": "Adam",
  "family_name": "Eggleston",
  "nickname": "adam.rh.eggleston",
  "name": "Adam Eggleston",
  "picture": "https://lh5.googleusercontent.com/-W0vlMbTCgJc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfxanaBi7gTVh48fG3YiMZPD-Phzg/photo.jpg",
  "locale": "en",
  "updated_at": "2019-09-11T04:27:21.691Z",
  "email": "adam.rh.eggleston@gmail.com",
  "email_verified": true,
  "iss": "https://dev-iwdal1jj.au.auth0.com/",
  "sub": "google-oauth2|110737208395021006987",
  "aud": "uWGGcp8fK4hR7tGJAk85Oxdf9DpUK5rD",
  "iat": 1568176046,
  "exp": 1568212046,
  "nonce": "Clf1PAbTmv2PBb_f66tJy_MKCqu78O85DR9_F0LiYRM"
}

Login JWT
eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IlJVWkNOREF5TURBMFEwWkJRelZFTXpjNFJEVXhOMFV6T1Rrd1JFRTJOemRCTlVVMVFrTkZNUSJ9.eyJuaWNrbmFtZSI6ImFkYW0ucmguZWdnbGVzdG9uIiwibmFtZSI6ImFkYW0ucmguZWdnbGVzdG9uQGdtYWlsLmNvbSIsInBpY3R1cmUiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci85ZjA1MTA3NmRlNDNmYTRkZjBjMTU0MmJmNDYxYTY2Nj9zPTQ4MCZyPXBnJmQ9aHR0cHMlM0ElMkYlMkZjZG4uYXV0aDAuY29tJTJGYXZhdGFycyUyRmFkLnBuZyIsInVwZGF0ZWRfYXQiOiIyMDE5LTA5LTExVDA0OjMwOjMwLjQ0NFoiLCJlbWFpbCI6ImFkYW0ucmguZWdnbGVzdG9uQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwiaXNzIjoiaHR0cHM6Ly9kZXYtaXdkYWwxamouYXUuYXV0aDAuY29tLyIsInN1YiI6ImF1dGgwfDVkNzcxOTRhYjIzZDI2MGUwN2EyN2NlNCIsImF1ZCI6InVXR0djcDhmSzRoUjd0R0pBazg1T3hkZjlEcFVLNXJEIiwiaWF0IjoxNTY4MTc2MjMxLCJleHAiOjE1NjgyMTIyMzEsIm5vbmNlIjoicGM3TjZDVXlnM2VEcXMyeFVUZlMxSEdhMmRwMDR4dDh4OGw4c0gtS0lERyJ9.wzv9eq9whE2Sjc1zdvb80WcELxKqIHL18g7f_p3jg3bT0ZXz6-JjN-ULu9rOwPYZs_fqQuwaH78naNpEPKO3DfJg6z3swtPm2uUO04P1gt9Jm8rZ_rBVUw60_UOBFQHFWhk1aXAACNE99k2ivD8_yKImd0No_W5T0aVfbe-oDC48fi7F_n1LQ98THno7ZmQgOt-hXJaNfrf-5-4UObxtyc9oW5KXWGuRNO3DH1_rkRPlx4ghp3M6YN8zRm2dv2l4W-1V34Hd6j1hGN2H_O4BGVDz_I_sprDaGuksoU7XGUJsszHpHeXPgZ7d774DlYGEb9slhUKRaecoI08mc50rtQ
https://jwt.io/#debugger-io?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IlJVWkNOREF5TURBMFEwWkJRelZFTXpjNFJEVXhOMFV6T1Rrd1JFRTJOemRCTlVVMVFrTkZNUSJ9.eyJuaWNrbmFtZSI6ImFkYW0ucmguZWdnbGVzdG9uIiwibmFtZSI6ImFkYW0ucmguZWdnbGVzdG9uQGdtYWlsLmNvbSIsInBpY3R1cmUiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci85ZjA1MTA3NmRlNDNmYTRkZjBjMTU0MmJmNDYxYTY2Nj9zPTQ4MCZyPXBnJmQ9aHR0cHMlM0ElMkYlMkZjZG4uYXV0aDAuY29tJTJGYXZhdGFycyUyRmFkLnBuZyIsInVwZGF0ZWRfYXQiOiIyMDE5LTA5LTExVDA0OjMwOjMwLjQ0NFoiLCJlbWFpbCI6ImFkYW0ucmguZWdnbGVzdG9uQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwiaXNzIjoiaHR0cHM6Ly9kZXYtaXdkYWwxamouYXUuYXV0aDAuY29tLyIsInN1YiI6ImF1dGgwfDVkNzcxOTRhYjIzZDI2MGUwN2EyN2NlNCIsImF1ZCI6InVXR0djcDhmSzRoUjd0R0pBazg1T3hkZjlEcFVLNXJEIiwiaWF0IjoxNTY4MTc2MjMxLCJleHAiOjE1NjgyMTIyMzEsIm5vbmNlIjoicGM3TjZDVXlnM2VEcXMyeFVUZlMxSEdhMmRwMDR4dDh4OGw4c0gtS0lERyJ9.wzv9eq9whE2Sjc1zdvb80WcELxKqIHL18g7f_p3jg3bT0ZXz6-JjN-ULu9rOwPYZs_fqQuwaH78naNpEPKO3DfJg6z3swtPm2uUO04P1gt9Jm8rZ_rBVUw60_UOBFQHFWhk1aXAACNE99k2ivD8_yKImd0No_W5T0aVfbe-oDC48fi7F_n1LQ98THno7ZmQgOt-hXJaNfrf-5-4UObxtyc9oW5KXWGuRNO3DH1_rkRPlx4ghp3M6YN8zRm2dv2l4W-1V34Hd6j1hGN2H_O4BGVDz_I_sprDaGuksoU7XGUJsszHpHeXPgZ7d774DlYGEb9slhUKRaecoI08mc50rtQ&publicKey=-----BEGIN%20PUBLIC%20KEY-----%0AMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3cciXnGpyUIUzyGTb3zI%0Aefxc4B2uXa2hlNPCViQTiTSUJIrZZFz3aw6aAkur2mw3ffvGhshYdnHCjusBJLxV%0A6HE6t3I93IICVSyt9IUNR7gkbAiQYbJHXIy5Jbua52oa%2Be1QXTHk7Xl8tw4NpcTE%0AaepPAraIlg7a01qAWgi0NAFj26eD6qtJ0Lr3422tgt7qjFEWjE4nCgOKDZ%2BTUo5t%0A4FzfVwcTSGayx%2FH0DwakEvxQjMpkcVzlAYGjswsN2HFhqRvT7k3nUFK%2Bp52S%2F0rd%0AdBw7Eksu%2FYCZBBY9BZR4FHahWHZ1eN2o59CF7sMkDclL%2BehKni42MOfeShVUzGam%0AyQIDAQAB%0A-----END%20PUBLIC%20KEY-----%0A
{
  "nickname": "adam.rh.eggleston",
  "name": "adam.rh.eggleston@gmail.com",
  "picture": "https://s.gravatar.com/avatar/9f051076de43fa4df0c1542bf461a666?s=480&r=pg&d=https%3A%2F%2Fcdn.auth0.com%2Favatars%2Fad.png",
  "updated_at": "2019-09-11T04:30:30.444Z",
  "email": "adam.rh.eggleston@gmail.com",
  "email_verified": false,
  "iss": "https://dev-iwdal1jj.au.auth0.com/",
  "sub": "auth0|5d77194ab23d260e07a27ce4",
  "aud": "uWGGcp8fK4hR7tGJAk85Oxdf9DpUK5rD",
  "iat": 1568176231,
  "exp": 1568212231,
  "nonce": "pc7N6CUyg3eDqs2xUTfS1HGa2dp04xt8x8l8sH-KIDG"
}
*/